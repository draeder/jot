(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3078:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>V});var r=a(5155),o=a(2108),s=a(5695),n=a(2115),i=a(5);class l extends i.Ay{constructor(){super("JotDatabase"),this.version(1).stores({users:"id, email, provider",workspaces:"id, userId, name",cards:"id, workspaceId, x, y",connections:"id, workspaceId, fromCardId, toCardId"})}}let c=new l;var d=a(3654),g=a(8932),u=a(5196),x=a(4416),h=a(4616),p=a(4395),m=a(6287),f=a(2525),y=a(1368),b=a(1243);function w(e){let{isOpen:t,onClose:a,onConfirm:o,title:s,message:n,confirmText:i="Confirm",cancelText:l="Cancel",variant:c="danger"}=e;if(!t)return null;let d={danger:{icon:"text-red-600",button:"bg-red-600 hover:bg-red-700 focus:ring-red-500"},warning:{icon:"text-yellow-600",button:"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500"},info:{icon:"text-blue-600",button:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"}}[c];return(0,r.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,r.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"relative bg-white rounded-lg shadow-lg border border-gray-200 max-w-md w-full mx-auto",children:[(0,r.jsx)("button",{onClick:a,className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",children:(0,r.jsx)(x.A,{size:18})}),(0,r.jsxs)("div",{className:"p-5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 ".concat(d.icon),children:(0,r.jsx)(b.A,{size:20})}),(0,r.jsx)("div",{children:(0,r.jsx)("h3",{className:"text-base font-medium text-gray-900",children:s})})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-5 ml-8",children:n}),(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsx)("button",{onClick:a,className:"px-3 py-2 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",children:l}),(0,r.jsx)("button",{onClick:()=>{o(),a()},className:"px-3 py-2 text-xs font-medium text-white rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 ".concat(d.button),children:i})]})]})]})})})}function v(e){let{selectedWorkspaceId:t,onWorkspaceSelect:a}=e,{data:s}=(0,o.useSession)(),[i,l]=(0,n.useState)([]),[b,v]=(0,n.useState)(!1),[k,j]=(0,n.useState)(""),[N,C]=(0,n.useState)(null),[E,A]=(0,n.useState)(""),[S,I]=(0,n.useState)([]),[D,T]=(0,n.useState)([]),[O,R]=(0,n.useState)({isOpen:!1,workspaceId:"",workspaceName:""}),M=e=>{I(t=>[...t,e].slice(-20)),T([])},z=(0,n.useCallback)(async()=>{var e;if(null==s||null==(e=s.user)?void 0:e.email)try{let e=await c.users.where("email").equals(s.user.email).first();if(!e)return;let r=await c.workspaces.where("userId").equals(e.id).toArray();r.sort((e,t)=>t.updatedAt.getTime()-e.updatedAt.getTime()),l(r),!t&&r.length>0&&a(r[0].id)}catch(e){console.error("Error loading workspaces:",e)}},[s,t,a]);(0,n.useEffect)(()=>{z()},[z]);let P=async()=>{var e;if((null==s||null==(e=s.user)?void 0:e.email)&&k.trim())try{let e=await c.users.where("email").equals(s.user.email).first();if(!e)return;let t={id:(0,y.A)(),name:k.trim(),userId:e.id,createdAt:new Date,updatedAt:new Date};await c.workspaces.add(t),l(e=>[t,...e]),a(t.id),v(!1),j(""),M({type:"CREATE_WORKSPACE",workspace:t})}catch(e){console.error("Error creating workspace:",e)}},W=async(e,t)=>{if(!t.trim())return;let a=i.find(t=>t.id===e);if(a)try{let r={...a,name:t.trim(),updatedAt:new Date};await c.workspaces.update(e,{name:t.trim(),updatedAt:new Date}),l(t=>t.map(t=>t.id===e?r:t)),C(null),A(""),a.name!==t.trim()&&M({type:"UPDATE_WORKSPACE",oldWorkspace:a,newWorkspace:r})}catch(e){console.error("Error updating workspace:",e)}},_=async e=>{let r=i.find(t=>t.id===e);if(r)try{let o=await c.cards.where("workspaceId").equals(e).toArray(),s=await c.connections.where("workspaceId").equals(e).toArray();if(await c.cards.where("workspaceId").equals(e).delete(),await c.connections.where("workspaceId").equals(e).delete(),await c.workspaces.delete(e),l(t=>t.filter(t=>t.id!==e)),t===e){let t=i.filter(t=>t.id!==e);a(t.length>0?t[0].id:"")}M({type:"DELETE_WORKSPACE",workspace:r,cards:o,connections:s})}catch(e){console.error("Error deleting workspace:",e)}},L=(e,t)=>{R({isOpen:!0,workspaceId:e,workspaceName:t})},U=async()=>{if(0===S.length)return;let e=S[S.length-1];I(e=>e.slice(0,-1)),T(t=>[...t,e].slice(-20));try{switch(e.type){case"CREATE_WORKSPACE":if(await c.workspaces.delete(e.workspace.id),l(t=>t.filter(t=>t.id!==e.workspace.id)),t===e.workspace.id){let t=i.filter(t=>t.id!==e.workspace.id);a(t.length>0?t[0].id:"")}break;case"DELETE_WORKSPACE":for(let t of(await c.workspaces.add(e.workspace),l(t=>[e.workspace,...t]),e.cards))await c.cards.add(t);for(let t of e.connections)await c.connections.add(t);break;case"UPDATE_WORKSPACE":await c.workspaces.update(e.oldWorkspace.id,e.oldWorkspace),l(t=>t.map(t=>t.id===e.oldWorkspace.id?e.oldWorkspace:t))}}catch(t){console.error("Error performing undo:",t),I(t=>[...t,e]),T(e=>e.slice(0,-1))}},q=async()=>{if(0===D.length)return;let e=D[D.length-1];T(e=>e.slice(0,-1)),I(t=>[...t,e].slice(-20));try{switch(e.type){case"CREATE_WORKSPACE":await c.workspaces.add(e.workspace),l(t=>[e.workspace,...t]);break;case"DELETE_WORKSPACE":if(await c.workspaces.delete(e.workspace.id),await c.cards.where("workspaceId").equals(e.workspace.id).delete(),await c.connections.where("workspaceId").equals(e.workspace.id).delete(),l(t=>t.filter(t=>t.id!==e.workspace.id)),t===e.workspace.id){let t=i.filter(t=>t.id!==e.workspace.id);a(t.length>0?t[0].id:"")}break;case"UPDATE_WORKSPACE":await c.workspaces.update(e.newWorkspace.id,e.newWorkspace),l(t=>t.map(t=>t.id===e.newWorkspace.id?e.newWorkspace:t))}}catch(t){console.error("Error performing redo:",t),I(e=>e.slice(0,-1)),T(t=>[...t,e])}},B=e=>{C(e.id),A(e.name)},G=()=>{C(null),A("")};return(0,r.jsxs)("div",{className:"w-64 min-w-64 flex-shrink-0 bg-white border-r border-gray-200 flex flex-col",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Workspaces"}),(0,r.jsxs)("div",{className:"flex justify-start gap-1 mb-3",children:[(0,r.jsxs)("button",{onClick:U,disabled:0===S.length,className:"flex items-center gap-1 px-2 py-1 rounded text-xs ".concat(0===S.length?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-100 text-gray-700 hover:bg-gray-200"),title:"Undo workspace action (".concat(S.length," available)"),children:[(0,r.jsx)(d.A,{size:12}),"Undo"]}),(0,r.jsxs)("button",{onClick:q,disabled:0===D.length,className:"flex items-center gap-1 px-2 py-1 rounded text-xs ".concat(0===D.length?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-100 text-gray-700 hover:bg-gray-200"),title:"Redo workspace action (".concat(D.length," available)"),children:[(0,r.jsx)(g.A,{size:12}),"Redo"]})]}),b?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"text",value:k,onChange:e=>j(e.target.value),placeholder:"Workspace name",className:"flex-1 px-2 py-1 border border-gray-300 rounded text-sm",autoFocus:!0,onKeyPress:e=>{"Enter"===e.key&&P(),"Escape"===e.key&&(v(!1),j(""))}}),(0,r.jsx)("button",{onClick:P,className:"p-1 text-green-600 hover:bg-green-100 rounded",title:"Create",children:(0,r.jsx)(u.A,{size:16})}),(0,r.jsx)("button",{onClick:()=>{v(!1),j("")},className:"p-1 text-gray-600 hover:bg-gray-100 rounded",title:"Cancel",children:(0,r.jsx)(x.A,{size:16})})]}):(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsxs)("button",{onClick:()=>v(!0),className:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:[(0,r.jsx)(h.A,{size:16}),"New Workspace"]})})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[i.map(e=>(0,r.jsxs)("div",{className:"group relative flex items-center px-4 py-3 hover:bg-gray-50 cursor-pointer min-w-0 ".concat(t===e.id?"bg-blue-50 border-r-2 border-blue-500":""),onClick:()=>!N&&a(e.id),children:[(0,r.jsx)(p.A,{size:16,className:"mr-3 flex-shrink-0 ".concat(t===e.id?"text-blue-600":"text-gray-400")}),N===e.id?(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[(0,r.jsx)("input",{type:"text",value:E,onChange:e=>A(e.target.value),className:"flex-1 px-2 py-1 border border-gray-300 rounded text-sm",autoFocus:!0,onKeyPress:t=>{"Enter"===t.key&&W(e.id,E),"Escape"===t.key&&G()}}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),W(e.id,E)},className:"p-1 text-green-600 hover:bg-green-100 rounded",title:"Save",children:(0,r.jsx)(u.A,{size:14})}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),G()},className:"p-1 text-gray-600 hover:bg-gray-100 rounded",title:"Cancel",children:(0,r.jsx)(x.A,{size:14})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"flex-1 text-sm ".concat(t===e.id?"text-blue-900 font-medium":"text-gray-700"," overflow-hidden text-ellipsis whitespace-nowrap pr-2"),children:e.name}),(0,r.jsxs)("div",{className:"opacity-0 group-hover:opacity-100 flex items-center gap-1 flex-shrink-0 ml-2",children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),B(e)},className:"p-1 text-gray-600 hover:bg-gray-200 rounded",title:"Rename",children:(0,r.jsx)(m.A,{size:12})}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),L(e.id,e.name)},className:"p-1 text-red-600 hover:bg-red-100 rounded",title:"Delete",children:(0,r.jsx)(f.A,{size:12})})]})]})]},e.id)),0===i.length&&!b&&(0,r.jsxs)("div",{className:"p-4 text-center text-gray-500 text-sm",children:["No workspaces yet.",(0,r.jsx)("br",{}),"Create your first workspace to get started."]})]}),(0,r.jsx)(w,{isOpen:O.isOpen,onClose:()=>R({isOpen:!1,workspaceId:"",workspaceName:""}),onConfirm:()=>{_(O.workspaceId),R({isOpen:!1,workspaceId:"",workspaceName:""})},title:"Remove Workspace",message:'Remove "'.concat(O.workspaceName,'" from your workspace list? This will also remove all cards and connections in this workspace. You can undo this action if needed.'),confirmText:"Remove",cancelText:"Keep",variant:"warning"})]})}var k=a(5472),j=a(5109),N=a(8292),C=a(7360),E=a(99),A=a(1788),S=a(9727),I=a(9144),D=a(2643),T=a(5968),O=a(9140),R=a(224);function M(e){let{content:t,onChange:a,placeholder:o="Start typing...",className:s=""}=e,i=(0,j.hG)({extensions:[N.A.configure({codeBlock:!1}),C.A.configure({placeholder:o}),E.Ay,A.A.configure({className:"has-focus",mode:"all"})],content:t,immediatelyRender:!1,onUpdate:e=>{let{editor:t}=e;a(t.getHTML())},editorProps:{attributes:{class:"prose prose-sm max-w-none focus:outline-none min-h-[100px] p-3"}}});return((0,n.useEffect)(()=>{i&&t!==i.getHTML()&&i.commands.setContent(t)},[t,i]),i)?(0,r.jsxs)("div",{className:"rich-text-editor border border-gray-200 rounded-lg flex flex-col h-full ".concat(s),children:[(0,r.jsxs)("div",{className:"border-b border-gray-200 p-2 flex items-center gap-1 bg-gray-50 rounded-t-lg flex-shrink-0",children:[(0,r.jsx)("button",{onClick:()=>i.chain().focus().toggleBold().run(),className:"p-2 rounded hover:bg-gray-200 text-black ".concat(i.isActive("bold")?"bg-gray-300":""),title:"Bold",children:(0,r.jsx)(S.A,{size:16,strokeWidth:2,className:"text-black"})}),(0,r.jsx)("button",{onClick:()=>i.chain().focus().toggleItalic().run(),className:"p-2 rounded hover:bg-gray-200 text-black ".concat(i.isActive("italic")?"bg-gray-300":""),title:"Italic",children:(0,r.jsx)(I.A,{size:16,strokeWidth:2,className:"text-black"})}),(0,r.jsx)("button",{onClick:()=>i.chain().focus().toggleStrike().run(),className:"p-2 rounded hover:bg-gray-200 text-black ".concat(i.isActive("strike")?"bg-gray-300":""),title:"Strikethrough",children:(0,r.jsx)(D.A,{size:16,strokeWidth:2,className:"text-black"})}),(0,r.jsx)("button",{onClick:()=>i.chain().focus().toggleCode().run(),className:"p-2 rounded hover:bg-gray-200 text-black ".concat(i.isActive("code")?"bg-gray-300":""),title:"Inline Code",children:(0,r.jsx)("span",{className:"text-sm font-mono text-black font-bold",children:"</>"})}),(0,r.jsx)("div",{className:"w-px h-6 bg-gray-300 mx-1"}),(0,r.jsx)("button",{onClick:()=>i.chain().focus().toggleBulletList().run(),className:"p-2 rounded hover:bg-gray-200 text-black ".concat(i.isActive("bulletList")?"bg-gray-300":""),title:"Bullet List",children:(0,r.jsx)(T.A,{size:16,strokeWidth:2,className:"text-black"})}),(0,r.jsx)("button",{onClick:()=>i.chain().focus().toggleOrderedList().run(),className:"p-2 rounded hover:bg-gray-200 text-black ".concat(i.isActive("orderedList")?"bg-gray-300":""),title:"Numbered List",children:(0,r.jsx)(O.A,{size:16,strokeWidth:2,className:"text-black"})}),(0,r.jsx)("button",{onClick:()=>i.chain().focus().toggleBlockquote().run(),className:"p-2 rounded hover:bg-gray-200 text-black ".concat(i.isActive("blockquote")?"bg-gray-300":""),title:"Quote",children:(0,r.jsx)(R.A,{size:16,strokeWidth:2,className:"text-black"})}),(0,r.jsx)("div",{className:"w-px h-6 bg-gray-300 mx-1"}),(0,r.jsx)("button",{onClick:()=>i.chain().focus().undo().run(),disabled:!i.can().undo(),className:"p-2 rounded hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed text-black",title:"Undo",children:(0,r.jsx)(d.A,{size:16,strokeWidth:2,className:i.can().undo()?"text-black":"text-gray-400"})}),(0,r.jsx)("button",{onClick:()=>i.chain().focus().redo().run(),disabled:!i.can().redo(),className:"p-2 rounded hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed text-black",title:"Redo",children:(0,r.jsx)(g.A,{size:16,strokeWidth:2,className:i.can().redo()?"text-black":"text-gray-400"})})]}),(0,r.jsx)("div",{className:"overflow-auto flex-1 min-h-0",children:(0,r.jsx)(j.$Z,{editor:i})})]}):null}var z=a(8021);function P(e){let{card:t,onUpdate:a,onDelete:o,onSelect:s,isSelected:i,snapToGrid:l=!1,gridSize:c=20,forceFinishEditingTimestamp:d=0,connectingMode:g=!1}=e,[u,h]=(0,n.useState)(!1),[p,f]=(0,n.useState)(0);(0,n.useEffect)(()=>{console.log("Card ".concat(t.id," isEditing changed to:"),u)},[u,t.id]);let[y,b]=(0,n.useState)(t.title),[w,v]=(0,n.useState)(t.content),[j,N]=(0,n.useState)(!1),C=(0,n.useRef)(null),E=(0,n.useCallback)((e,t)=>l?{width:Math.round(e/c)*c,height:Math.round(t/c)*c}:{width:e,height:t},[l,c]),{attributes:A,listeners:S,setNodeRef:I,transform:D,isDragging:T}=(0,k.PM)({id:t.id,data:{type:"card",card:t},disabled:j||u}),O=D?{transform:"translate3d(".concat(D.x,"px, ").concat(D.y,"px, 0)"),zIndex:T?1e3:void 0,left:t.x,top:t.y}:{left:t.x,top:t.y};(0,n.useEffect)(()=>{let e=e=>{if(!j||!C.current)return;let r=C.current.getBoundingClientRect(),o=e.clientX-r.left,s=e.clientY-r.top,n=E(o=Math.max(200,o),s=Math.max(150,s));o=n.width,s=n.height,a({...t,width:o,height:s,updatedAt:new Date})},r=()=>{N(!1)};return j&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",r)),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",r)}},[j,t,a,l,c,E]);let R=(0,n.useCallback)(()=>{console.log("handleSave called, setting isEditing to false"),a({...t,title:y,content:w,updatedAt:new Date}),h(!1)},[t,y,w,a]);return(0,n.useEffect)(()=>{if(d>0&&u){if(Date.now()-p<100)return void console.log("Ignoring force finish editing - just started editing");console.log("Force finish editing triggered"),R()}},[d,R,u,p]),(0,r.jsxs)("div",{ref:e=>{I(e),C.current=e},style:{...O,width:t.width,height:t.height},className:"absolute bg-white border-2 rounded-lg shadow-lg flex flex-col cursor-default ".concat(i?"border-blue-500":"border-gray-200"," ").concat(T?"opacity-50":""," ").concat(g?"hover:border-orange-400 hover:shadow-orange-200":""),"data-card-id":t.id,onClick:e=>{e.stopPropagation(),s(t.id)},onMouseDown:e=>{e.stopPropagation()},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-gray-200 bg-gray-50 rounded-t-lg",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[(0,r.jsx)("div",{...A,...S,className:"cursor-grab active:cursor-grabbing p-2 hover:bg-gray-200 rounded flex-shrink-0",style:{touchAction:"none"},children:(0,r.jsx)(z.A,{size:16,className:"text-gray-400"})}),u?(0,r.jsx)("input",{type:"text",value:y,onChange:e=>b(e.target.value),className:"flex-1 px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Card title",autoFocus:!0}):(0,r.jsx)("h3",{className:"flex-1 font-medium text-sm text-gray-900 truncate",children:t.title||"Untitled Card"})]}),(0,r.jsx)("div",{className:"flex items-center gap-1",children:u?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:R,className:"p-1 text-green-600 hover:bg-green-100 rounded",title:"Save",children:"✓"}),(0,r.jsx)("button",{onClick:()=>{console.log("handleCancel called, setting isEditing to false"),b(t.title),v(t.content),h(!1)},className:"p-1 text-gray-600 hover:bg-gray-100 rounded",title:"Cancel",children:"✗"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:e=>{console.log("Edit button clicked!"),e.stopPropagation(),console.log("Setting isEditing to true"),f(Date.now()),h(!0)},className:"p-1 text-gray-600 hover:bg-gray-100 rounded",title:"Edit",children:(0,r.jsx)(m.A,{size:14})}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),o(t.id)},className:"p-1 text-red-600 hover:bg-red-100 rounded",title:"Delete",children:(0,r.jsx)(x.A,{size:14})})]})})]}),(0,r.jsx)("div",{className:"flex-1 p-2 overflow-hidden",children:u?(0,r.jsx)(M,{content:w,onChange:v,placeholder:"Write your note here...",className:"flex-1 min-h-0 h-full"}):(0,r.jsx)("div",{className:"prose prose-sm max-w-none h-full overflow-auto hover:bg-gray-50 ".concat(g?"cursor-crosshair":"cursor-pointer"),onClick:e=>{console.log("Content area clicked!",{connectingMode:g,isEditing:u}),console.log("Event target:",e.target),console.log("Current target:",e.currentTarget),e.stopPropagation(),e.preventDefault(),g?s(t.id):(console.log("Setting isEditing to true from content click"),f(Date.now()),h(!0))},onMouseDown:e=>{e.stopPropagation()},dangerouslySetInnerHTML:{__html:t.content||'<p class="text-gray-500 text-sm">Click to add content...</p>'}})}),(0,r.jsx)("div",{className:"absolute bottom-0 right-0 w-4 h-4 cursor-se-resize bg-gray-300 hover:bg-gray-400",style:{clipPath:"polygon(100% 0%, 0% 100%, 100% 100%)"},onMouseDown:e=>{e.preventDefault(),N(!0)}})]})}var W=a(2138),_=a(7712),L=a(4653),U=a(133),q=a(2355),B=a(3052),G=a(7863),F=a(6474);let H=(0,n.forwardRef)((e,t)=>{let{workspaceId:a}=e,[o,s]=(0,n.useState)([]),[i,l]=(0,n.useState)([]),[u,x]=(0,n.useState)(null),[p,m]=(0,n.useState)(null),[f,b]=(0,n.useState)(!1),[w,v]=(0,n.useState)(null),[j,N]=(0,n.useState)(0),[C,E]=(0,n.useState)([]),[A,S]=(0,n.useState)([]),[I,D]=(0,n.useState)(()=>localStorage.getItem("jot-grid-type")||"dots"),[T,O]=(0,n.useState)(()=>{{let e=localStorage.getItem("jot-snap-to-grid");return!!e&&"true"===e}}),[R,M]=(0,n.useState)(!1),[z,H]=(0,n.useState)({x:0,y:0}),[K,Y]=(0,n.useState)(()=>{{let e=localStorage.getItem("jot-pan-offset");return e?JSON.parse(e):{x:0,y:0}}}),X=(0,n.useCallback)(()=>{if(0===o.length)return void Y({x:20,y:20});let e=Math.min(...o.map(e=>e.x)),t=Math.min(...o.map(e=>e.y));console.log("\uD83D\uDD0D RESET DEBUG:"),console.log("  gridMargin:",20),console.log("  minX (leftmost card x):",e),console.log("  minY (topmost card y):",t),console.log("  Required panOffset.x:",20-e),console.log("  Required panOffset.y:",20-t);let a={x:20-e,y:20-t};Y(a),setTimeout(()=>{console.log("\uD83D\uDD0D POST-RESET DEBUG:"),console.log("  panOffset after reset:",a),console.log("  Expected leftmost card screen position: minX + panOffset.x =",e+a.x),console.log("  Should equal gridMargin (20px):",20)},100)},[o,20]);(0,n.useImperativeHandle)(t,()=>({resetView:X}),[X]);let[V,J]=(0,n.useState)({left:!1,right:!1,up:!1,down:!1});(0,n.useEffect)(()=>{localStorage.setItem("jot-pan-offset",JSON.stringify(K))},[K]),(0,n.useEffect)(()=>{localStorage.setItem("jot-grid-type",I)},[I]),(0,n.useEffect)(()=>{localStorage.setItem("jot-snap-to-grid",T.toString())},[T]),(0,n.useEffect)(()=>{if(0===o.length)return void J({left:!1,right:!1,up:!1,down:!1});let e=window.innerWidth-256,t=window.innerHeight-80,a=-K.x,r=-K.x+e,s=-K.y,n=-K.y+t,i=!1,l=!1,c=!1,d=!1;o.forEach(e=>{e.x+e.width<a&&(i=!0),e.x>r&&(l=!0),e.y+e.height<s&&(c=!0),e.y>n&&(d=!0)}),J({left:i,right:l,up:c,down:d})},[o,K]),(0,n.useEffect)(()=>{let e=()=>{if(0===o.length)return void J({left:!1,right:!1,up:!1,down:!1});let e=window.innerWidth-256,t=window.innerHeight-80,a=-K.x,r=-K.x+e,s=-K.y,n=-K.y+t,i=!1,l=!1,c=!1,d=!1;o.forEach(e=>{e.x+e.width<a&&(i=!0),e.x>r&&(l=!0),e.y+e.height<s&&(c=!0),e.y>n&&(d=!0)}),J({left:i,right:l,up:c,down:d})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[o,K]);let Q=e=>{E(t=>[...t,e].slice(-50)),S([])},Z=async()=>{if(0===C.length)return;let e=C[C.length-1];E(e=>e.slice(0,-1)),S(t=>[...t,e].slice(-50));try{switch(e.type){case"CREATE_CARD":await c.cards.delete(e.cardId),s(t=>t.filter(t=>t.id!==e.cardId)),u===e.cardId&&x(null);break;case"DELETE_CARD":for(let t of(await c.cards.add(e.card),s(t=>[...t,e.card]),e.connections))await c.connections.add(t);l(t=>[...t,...e.connections]);break;case"UPDATE_CARD":await c.cards.update(e.oldCard.id,e.oldCard),s(t=>t.map(t=>t.id===e.oldCard.id?e.oldCard:t));break;case"MOVE_CARD":let t=o.find(t=>t.id===e.cardId);if(t){let a={...t,x:e.oldPosition.x,y:e.oldPosition.y,updatedAt:new Date};await c.cards.update(e.cardId,a),s(t=>t.map(t=>t.id===e.cardId?a:t))}break;case"CREATE_CONNECTION":await c.connections.delete(e.connectionId),l(t=>t.filter(t=>t.id!==e.connectionId));break;case"DELETE_CONNECTION":await c.connections.add(e.connection),l(t=>[...t,e.connection])}}catch(t){console.error("Error performing undo:",t),E(t=>[...t,e]),S(e=>e.slice(0,-1))}},$=async()=>{if(0===A.length)return;let e=A[A.length-1];S(e=>e.slice(0,-1)),E(t=>[...t,e].slice(-50));try{switch(e.type){case"CREATE_CARD":let t=await c.cards.get(e.cardId);t&&s(e=>[...e,t]);break;case"DELETE_CARD":for(let t of(await c.cards.delete(e.card.id),e.connections))await c.connections.delete(t.id);s(t=>t.filter(t=>t.id!==e.card.id)),l(t=>t.filter(t=>t.fromCardId!==e.card.id&&t.toCardId!==e.card.id)),u===e.card.id&&x(null);break;case"UPDATE_CARD":await c.cards.update(e.newCard.id,e.newCard),s(t=>t.map(t=>t.id===e.newCard.id?e.newCard:t));break;case"MOVE_CARD":let a=o.find(t=>t.id===e.cardId);if(a){let t={...a,x:e.newPosition.x,y:e.newPosition.y,updatedAt:new Date};await c.cards.update(e.cardId,t),s(a=>a.map(a=>a.id===e.cardId?t:a))}break;case"CREATE_CONNECTION":let r=await c.connections.get(e.connectionId);r&&l(e=>[...e,r]);break;case"DELETE_CONNECTION":await c.connections.delete(e.connection.id),l(t=>t.filter(t=>t.id!==e.connection.id))}}catch(t){console.error("Error performing redo:",t),E(e=>e.slice(0,-1)),S(t=>[...t,e])}},ee=(0,k.FR)((0,k.MS)(k.AN,{activationConstraint:{distance:8}})),et=(0,n.useCallback)(async()=>{try{let e=await c.cards.where("workspaceId").equals(a).toArray();s(e)}catch(e){console.error("Error loading cards:",e)}},[a]),ea=(0,n.useCallback)(async()=>{try{let e=await c.connections.where("workspaceId").equals(a).toArray();l(e)}catch(e){console.error("Error loading connections:",e)}},[a]);(0,n.useEffect)(()=>{et(),ea()},[et,ea]);let er=(e,t)=>T?{x:20*Math.round(e/20),y:20*Math.round(t/20)}:{x:e,y:t},eo=async(e,t)=>{let r=null!=e?e:0,n=null!=t?t:0;(void 0===e||void 0===t)&&(r=-K.x+20,n=-K.y+20,console.log("\uD83C\uDFAF NEW CARD POSITIONING:"),console.log("  panOffset:",K),console.log("  viewport top-left in world coords:",{x:-K.x,y:-K.y}),console.log("  card position with margin:",{x:r,y:n}));let i=er(r,n);r=i.x,n=i.y;let l={left:r,right:r+350,top:n,bottom:n+280};if(o.some(e=>{let t={left:e.x,right:e.x+e.width,top:e.y,bottom:e.y+e.height};return!(l.right<=t.left||l.left>=t.right||l.bottom<=t.top||l.top>=t.bottom)})){console.log("\uD83D\uDD04 COLLISION DETECTED - Finding free position...");let e=0;for(;e<20;){for(let e of[{x:40,y:40},{x:80,y:40},{x:40,y:80},{x:80,y:80},{x:120,y:40},{x:40,y:120},{x:120,y:120}]){let t=r+e.x,a=n+e.y,s={left:t,right:t+350,top:a,bottom:a+280};if(!o.some(e=>{let t={left:e.x,right:e.x+e.width,top:e.y,bottom:e.y+e.height};return!(s.right<=t.left||s.left>=t.right||s.bottom<=t.top||s.top>=t.bottom)})){console.log("✅ Found free position:",{x:r=t,y:n=a});break}}if(e++,!o.some(e=>{let t={left:e.x,right:e.x+e.width,top:e.y,bottom:e.y+e.height},a={left:r,right:r+350,top:n,bottom:n+280};return!(a.right<=t.left||a.left>=t.right||a.bottom<=t.top||a.top>=t.bottom)}))break}e>=20&&console.log("⚠️ Could not find free position after",20,"attempts")}else console.log("✅ No collision detected - placing at original position");let d={id:(0,y.A)(),workspaceId:a,title:"New Card",content:"",x:r,y:n,width:350,height:280,createdAt:new Date,updatedAt:new Date};try{await c.cards.add(d),s(e=>[...e,d]),x(d.id),Q({type:"CREATE_CARD",cardId:d.id})}catch(e){console.error("Error creating card:",e)}},es=async e=>{let t=o.find(t=>t.id===e.id);try{await c.cards.update(e.id,e),s(t=>t.map(t=>t.id===e.id?e:t)),t&&(t.title!==e.title||t.content!==e.content)&&Q({type:"UPDATE_CARD",oldCard:t,newCard:e})}catch(e){console.error("Error updating card:",e)}},en=async e=>{try{await c.cards.update(e.id,e)}catch(e){console.error("Error updating card in database:",e),et()}},ei=async e=>{let t=o.find(t=>t.id===e);if(t)try{let a=i.filter(t=>t.fromCardId===e||t.toCardId===e);for(let t of(await c.cards.delete(e),a))await c.connections.delete(t.id);s(t=>t.filter(t=>t.id!==e)),l(t=>t.filter(t=>t.fromCardId!==e&&t.toCardId!==e)),u===e&&x(null),Q({type:"DELETE_CARD",card:t,connections:a})}catch(e){console.error("Error deleting card:",e)}},el=async(e,t)=>{if(e===t||i.find(a=>a.fromCardId===e&&a.toCardId===t||a.fromCardId===t&&a.toCardId===e))return;let r={id:(0,y.A)(),workspaceId:a,fromCardId:e,toCardId:t,type:"arrow",createdAt:new Date};try{await c.connections.add(r),l(e=>[...e,r]),Q({type:"CREATE_CONNECTION",connectionId:r.id})}catch(e){console.error("Error creating connection:",e)}},ec=async e=>{let t=i.find(t=>t.id===e);if(t)try{await c.connections.delete(e),l(t=>t.filter(t=>t.id!==e)),Q({type:"DELETE_CONNECTION",connection:t})}catch(e){console.error("Error deleting connection:",e)}},ed=e=>{if(0===o.length)return;let t=window.innerWidth-256,a=window.innerHeight-80,r=-K.x,s=-K.x+t,n=-K.y,i=-K.y+a,l=[];if(o.forEach(t=>{let a=t.x,o=t.x+t.width,c=t.y,d=t.y+t.height;switch(e){case"left":o<r&&l.push(t);break;case"right":a>s&&l.push(t);break;case"up":d<n&&l.push(t);break;case"down":c>i&&l.push(t)}}),0===l.length)return;let c=Math.min(...o.map(e=>e.x)),d=Math.min(...o.map(e=>e.y)),g=Math.min(...l.map(e=>e.x)),u=Math.min(...l.map(e=>e.y));if("up"===e&&u===d||"left"===e&&g===c){console.log("\uD83D\uDD0D NAVIGATION TO PRIMARY CARDS - Using reset logic"),console.log("  direction:",e),console.log("  allMinX:",c,"targetMinX:",g),console.log("  allMinY:",d,"targetMinY:",u),console.log("  gridMargin:",20),console.log("  Setting panOffset to:",{x:20-c,y:20-d}),Y({x:20-c,y:20-d});return}let x=[];if("left"===e||"right"===e){let t=l.map(t=>"left"===e?r-(t.x+t.width):t.x-s),a=Math.min(...t.filter(e=>e>=0));x=l.filter((e,r)=>{let o=t[r];return o>=0&&o<=a+50})}else{let t=l.map(t=>"up"===e?n-(t.y+t.height):t.y-i),a=Math.min(...t.filter(e=>e>=0));x=l.filter((e,r)=>{let o=t[r];return o>=0&&o<=a+50})}let h=Math.min(...x.map(e=>e.x)),p=Math.min(...x.map(e=>e.y));console.log("\uD83D\uDD0D NAVIGATION TO CLOSEST CARDS"),console.log("  direction:",e),console.log("  closestCards count:",x.length),console.log("  closestMinX:",h),console.log("  closestMinY:",p),console.log("  gridMargin:",20),console.log("  Setting panOffset to:",{x:20-h,y:20-p}),Y({x:20-h,y:20-p})},eg=e=>{f?w?w!==e&&(el(w,e),b(!1),v(null)):v(e):x(e)},eu=e=>({x:e.x+e.width/2,y:e.y+e.height/2}),ex=(e,t)=>{let a=eu(e),r=eu(t),o=r.x-a.x,s=r.y-a.y;if(0===o&&0===s)return{from:a,to:r};let n=(e,t,a)=>{let r=t.width/2,o=t.height/2,s=Math.sqrt(a.x*a.x+a.y*a.y),n=a.x/s,i=a.y/s,l=1/0;return n>0?l=Math.min(l,r/n):n<0&&(l=Math.min(l,-r/n)),i>0?l=Math.min(l,o/i):i<0&&(l=Math.min(l,-o/i)),{x:e.x+n*l,y:e.y+i*l}};return{from:n(a,e,{x:o,y:s}),to:n(r,t,{x:-o,y:-s})}};return(0,r.jsxs)("div",{className:"relative w-full h-full bg-gray-50 flex flex-col",children:[(0,r.jsx)("div",{className:"flex-shrink-0 p-4 bg-white border-b border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("button",{onClick:()=>eo(),className:"flex items-center gap-2 px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",title:"Add Card",children:[(0,r.jsx)(h.A,{size:16}),"Add Card"]}),(0,r.jsxs)("button",{onClick:()=>{b(!f),v(null)},className:"flex items-center gap-2 px-3 py-2 rounded ".concat(f?"bg-orange-500 text-white hover:bg-orange-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"),title:"Connect Cards",children:[(0,r.jsx)(W.A,{size:16}),f?"Cancel Connect":"Connect"]}),u&&(0,r.jsxs)("button",{onClick:()=>ei(u),className:"flex items-center gap-2 px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600",title:"Delete Selected Card",children:[(0,r.jsx)(_.A,{size:16}),"Delete"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("button",{onClick:Z,disabled:0===C.length,className:"flex items-center gap-2 px-3 py-2 rounded ".concat(0===C.length?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-100 text-gray-700 hover:bg-gray-200"),title:"Undo (".concat(C.length," actions available)"),children:[(0,r.jsx)(d.A,{size:16}),"Undo"]}),(0,r.jsxs)("button",{onClick:$,disabled:0===A.length,className:"flex items-center gap-2 px-3 py-2 rounded ".concat(0===A.length?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-100 text-gray-700 hover:bg-gray-200"),title:"Redo (".concat(A.length," actions available)"),children:[(0,r.jsx)(g.A,{size:16}),"Redo"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 ml-4 border-l border-gray-300 pl-4",children:[(0,r.jsxs)("button",{onClick:()=>{D("off"===I?"dots":"dots"===I?"lines":"off")},className:"flex items-center gap-2 px-3 py-2 rounded ".concat("off"!==I?"bg-purple-500 text-white hover:bg-purple-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"),title:"Grid: ".concat("off"===I?"Off":"dots"===I?"Dots":"Lines"," (click to cycle)"),children:[(0,r.jsx)(L.A,{size:16}),"off"===I?"Grid: Off":"dots"===I?"Grid: Dots":"Grid: Lines"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"Snap:"}),(0,r.jsx)("button",{onClick:()=>O(!T),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 ".concat(T?"bg-purple-600":"bg-gray-200"),title:"Toggle Snap to Grid",children:(0,r.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(T?"translate-x-6":"translate-x-1")})})]}),(0,r.jsxs)("button",{onClick:X,className:"flex items-center gap-2 px-3 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200",title:"Reset View - Show all cards with optimal positioning",children:[(0,r.jsx)(U.A,{size:16}),"Reset"]})]}),f&&(0,r.jsx)("div",{className:"ml-4 bg-orange-100 border border-orange-200 rounded-lg px-3 py-2",children:(0,r.jsx)("p",{className:"text-orange-800 text-sm",children:w?"Click another card to create connection":"Click a card to start connecting"})}),i.length>0&&!f&&(0,r.jsx)("div",{className:"ml-4 bg-blue-50 border border-blue-200 rounded-lg px-3 py-2",children:(0,r.jsx)("p",{className:"text-blue-800 text-sm",children:"Click on arrows to delete connections"})})]})}),(0,r.jsxs)("div",{className:"flex-1 overflow-hidden bg-gray-50 relative ".concat(R?"cursor-grabbing":"cursor-grab"),style:{backgroundImage:"lines"===I?"linear-gradient(to right, #d1d5db 1px, transparent 1px), linear-gradient(to bottom, #d1d5db 1px, transparent 1px)":"dots"===I?"radial-gradient(circle, #d1d5db 1px, transparent 1px)":"none",backgroundSize:"off"!==I?"".concat(20,"px ").concat(20,"px"):"auto",backgroundPosition:"off"!==I?"".concat(K.x%20,"px ").concat(K.y%20,"px"):"auto"},onMouseDown:e=>{if(0===e.button){let t=e.target;t.closest("[data-card-id]")||t.closest(".prose")||t.closest("button")||t.closest("input")||t.closest("textarea")||t.closest("svg")||"BUTTON"===t.tagName||"INPUT"===t.tagName||"TEXTAREA"===t.tagName||"SVG"===t.tagName||t.classList.contains("prose")||t.closest(".ql-editor")||t.closest(".rich-text-editor")||(e.preventDefault(),e.stopPropagation(),M(!0),H({x:e.clientX-K.x,y:e.clientY-K.y}))}},onMouseMove:e=>{R&&(e.preventDefault(),e.stopPropagation(),Y({x:e.clientX-z.x,y:e.clientY-z.y}))},onMouseUp:()=>{M(!1)},onMouseLeave:()=>{M(!1)},onClick:e=>{e.target.closest("[data-card-id]")||(f&&w?(b(!1),v(null)):x(null),N(Date.now()))},children:[V.left&&(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),ed("left")},className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 bg-white/90 hover:bg-white border border-gray-300 rounded-full p-2 shadow-lg transition-all duration-200 hover:scale-110",title:"Navigate to cards on the left",children:(0,r.jsx)(q.A,{size:20,className:"text-gray-600"})}),V.right&&(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),ed("right")},className:"absolute right-4 top-1/2 -translate-y-1/2 z-20 bg-white/90 hover:bg-white border border-gray-300 rounded-full p-2 shadow-lg transition-all duration-200 hover:scale-110",title:"Navigate to cards on the right",children:(0,r.jsx)(B.A,{size:20,className:"text-gray-600"})}),V.up&&(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),ed("up")},className:"absolute top-4 left-1/2 -translate-x-1/2 z-20 bg-white/90 hover:bg-white border border-gray-300 rounded-full p-2 shadow-lg transition-all duration-200 hover:scale-110",title:"Navigate to cards above",children:(0,r.jsx)(G.A,{size:20,className:"text-gray-600"})}),V.down&&(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),ed("down")},className:"absolute bottom-4 left-1/2 -translate-x-1/2 z-20 bg-white/90 hover:bg-white border border-gray-300 rounded-full p-2 shadow-lg transition-all duration-200 hover:scale-110",title:"Navigate to cards below",children:(0,r.jsx)(F.A,{size:20,className:"text-gray-600"})}),(0,r.jsxs)(k.Mp,{sensors:ee,onDragStart:e=>{let{active:t}=e,a=o.find(e=>e.id===t.id);a&&m(a)},onDragEnd:e=>{let{active:t,delta:a}=e;if(m(null),!a||!t)return;let r=o.find(e=>e.id===t.id);if(!r)return;let n={x:r.x,y:r.y},i=r.x+a.x,l=r.y+a.y,c=-K.x,d=-K.y,g=c+window.innerWidth,u=d+window.innerHeight,x=er(i=Math.max(c-2e3,Math.min(g+2e3,i)),l=Math.max(d-2e3,Math.min(u+2e3,l)));i=x.x,l=x.y;let h={...r,x:i,y:l,updatedAt:new Date};s(e=>e.map(e=>e.id===h.id?h:e)),en(h),(n.x!==i||n.y!==l)&&Q({type:"MOVE_CARD",cardId:r.id,oldPosition:n,newPosition:{x:i,y:l}})},onDragCancel:()=>{m(null)},collisionDetection:k.Qo,children:[(0,r.jsxs)("svg",{className:"absolute top-0 left-0 pointer-events-none",style:{width:"100%",height:"100%",zIndex:5},children:[i.map(e=>{let t=o.find(t=>t.id===e.fromCardId),a=o.find(t=>t.id===e.toCardId);if(!t||!a)return null;let{from:s,to:n}=ex(t,a),i={x:s.x+K.x,y:s.y+K.y},l={x:n.x+K.x,y:n.y+K.y};return(0,r.jsxs)("g",{className:"group",children:[(0,r.jsx)("line",{x1:i.x,y1:i.y,x2:l.x,y2:l.y,stroke:"transparent",strokeWidth:"12",className:"pointer-events-auto cursor-pointer",onClick:t=>{t.stopPropagation(),ec(e.id)}}),(0,r.jsx)("line",{x1:i.x,y1:i.y,x2:l.x,y2:l.y,stroke:"#6B7280",strokeWidth:"2",markerEnd:"url(#arrowhead)",className:"pointer-events-none group-hover:opacity-50 transition-opacity"}),(0,r.jsx)("line",{x1:i.x,y1:i.y,x2:l.x,y2:l.y,stroke:"#ef4444",strokeWidth:"3",markerEnd:"url(#arrowhead-red)",className:"pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity"})]},e.id)}),(0,r.jsxs)("defs",{children:[(0,r.jsx)("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:(0,r.jsx)("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#6B7280"})}),(0,r.jsx)("marker",{id:"arrowhead-red",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:(0,r.jsx)("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#ef4444"})})]})]}),(0,r.jsx)("div",{className:"relative pointer-events-none",style:{minWidth:"300vw",minHeight:"300vh",width:"300vw",height:"300vh",transform:"translate(".concat(K.x,"px, ").concat(K.y,"px)"),zIndex:10},children:o.map(e=>(0,r.jsx)("div",{style:{pointerEvents:"auto"},children:(0,r.jsx)(P,{card:e,onUpdate:es,onDelete:ei,onSelect:eg,isSelected:u===e.id||w===e.id,snapToGrid:T,gridSize:20,forceFinishEditingTimestamp:j,connectingMode:f})},e.id))}),(0,r.jsx)(k.Hd,{children:p&&(0,r.jsx)("div",{className:"bg-white border-2 border-blue-500 rounded-lg shadow-xl opacity-80",style:{width:p.width,height:p.height},children:(0,r.jsx)("div",{className:"p-3 border-b border-gray-200 bg-gray-50",children:(0,r.jsx)("h3",{className:"font-medium text-sm text-gray-900",children:p.title||"Untitled Card"})})})})]})]})]})});H.displayName="WorkspaceCanvas";var K=a(1007),Y=a(4835);function X(){var e,t;let{data:a}=(0,o.useSession)(),[s,i]=(0,n.useState)(null),l=(0,n.useRef)(null);return((0,n.useEffect)(()=>{(async()=>{var e;if(null==a||null==(e=a.user)?void 0:e.email)try{if(!await c.users.where("email").equals(a.user.email).first()){let e=a.user.id||a.user.email||(0,y.A)();await c.users.add({id:e,email:a.user.email,name:a.user.name||"",image:a.user.image||void 0,provider:"unknown",createdAt:new Date,updatedAt:new Date}),console.log("User created in IndexedDB:",a.user.email)}}catch(e){console.error("Error creating user in IndexedDB:",e)}})()},[a]),a)?(0,r.jsxs)("div",{className:"h-screen flex flex-col",children:[(0,r.jsx)("header",{className:"bg-white border-b border-gray-200 px-6 py-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-6",children:[(0,r.jsx)("div",{className:"flex items-center gap-3",children:(0,r.jsx)("img",{src:"/jotlogo.png",alt:"Jot Logo",width:150,height:75,className:"object-contain"})}),s&&(0,r.jsx)("span",{className:"text-lg text-gray-500",children:"Visual note-taking workspace"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,r.jsx)(K.A,{size:16}),(0,r.jsx)("span",{children:(null==(e=a.user)?void 0:e.name)||(null==(t=a.user)?void 0:t.email)})]}),(0,r.jsxs)("button",{onClick:()=>(0,o.signOut)({callbackUrl:"/auth/signin"}),className:"flex items-center gap-2 px-3 py-1 text-sm text-gray-600 hover:bg-gray-100 rounded-lg",title:"Sign Out",children:[(0,r.jsx)(Y.A,{size:16}),"Sign Out"]})]})]})}),(0,r.jsxs)("div",{className:"flex-1 flex overflow-hidden min-h-0",children:[(0,r.jsx)(v,{selectedWorkspaceId:s,onWorkspaceSelect:e=>{i(e),s!==e&&null!==s&&setTimeout(()=>{var e;null==(e=l.current)||e.resetView()},100)}}),(0,r.jsx)("div",{className:"flex-1 flex flex-col min-w-0",children:s?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(H,{ref:l,workspaceId:s})}):(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"flex justify-center mb-6",children:(0,r.jsx)("img",{src:"/jotlogo.png",alt:"Jot Logo",width:120,height:80,className:"opacity-60 object-contain"})}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a workspace"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"Choose a workspace from the sidebar or create a new one to get started."})]})})})]})]}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Please sign in"}),(0,r.jsx)("p",{className:"text-gray-600",children:"You need to be authenticated to access your workspaces."})]})})}function V(){let{data:e,status:t}=(0,o.useSession)(),a=(0,s.useRouter)();return((0,n.useEffect)(()=>{"loading"!==t&&(e||a.push("/auth/signin"))},[e,t,a]),"loading"===t)?(0,r.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):e?(0,r.jsx)(X,{}):null}},5719:(e,t,a)=>{Promise.resolve().then(a.bind(a,3078))}},e=>{var t=t=>e(e.s=t);e.O(0,[4,277,108,726,441,684,358],()=>t(5719)),_N_E=e.O()}]);